---
alwaysApply: true
---
# 개별 플랏 함수 개발 가이드

이 가이드는 코딩 에이전트가 노트북 예시로부터 독립적인 플랏 함수를 라이브러리화하는 과정을 안내합니다.

## 1. 개요 및 목적

개별 플랏 함수는 특수화된 시각화 기능을 제공하는 독립적인 함수입니다. 이들은:
- 노트북 예시 파일로부터 추출되어 라이브러리화됩니다
- `src/dartwork_mpl/xplot/` 패키지 내에 독립된 모듈로 구현됩니다
- 사용자가 바로 사용할 수 있도록 샘플 데이터와 예시를 포함합니다

## 2. 입력 형식

### 2.1 예시 파일 위치

플랏 예시는 일반적으로 노트북 형태로 작성되며, 다음 경로 패턴을 따릅니다:

```
test/new_features/[plot] <plot_name>.ipynb
```

예시:
- `test/new_features/[plot] comparison_change_rate_dotplot.ipynb`
- `test/new_features/[plot] treemap.ipynb`
- `test/new_features/[plot] diverging_bargraph.ipynb`

### 2.2 예시 파일 구조

예시 노트북은 일반적으로 다음 구조를 가집니다:
1. **임포트 및 스타일 설정 셀**: `dartwork_mpl` 임포트 및 스타일 적용
2. **데이터 준비 셀**: 샘플 데이터 생성 또는 로드
3. **플랏 구현 셀**: 실제 시각화 코드
4. **결과 확인 셀**: `dm.save_and_show()` 등을 사용한 결과 확인

## 3. 구현 위치 및 구조

### 3.1 패키지 구조

모든 플랏 함수는 `src/dartwork_mpl/xplot/` 패키지 내에 구현됩니다:

```
src/dartwork_mpl/xplot/
├── __init__.py          # 패키지 초기화 및 함수 export
├── comparison_dotplot.py  # 예: comparison_change_rate_dotplot
├── treemap.py           # 예: treemap
├── diverging_bar.py     # 예: diverging_bargraph
└── ...                  # 기타 플랏 함수들
```

### 3.2 파일 네이밍 규칙

- 파일명은 소문자와 언더스코어를 사용합니다
- 플랏의 핵심 기능을 나타내는 간결한 이름을 사용합니다
- 예: `comparison_change_rate_dotplot.ipynb` → `comparison_dotplot.py`

### 3.3 모듈 독립성

각 플랏 함수는 **완전히 독립된 모듈**로 구현되어야 합니다:
- 다른 플랏 모듈에 의존하지 않아야 합니다
- `__init__.py`에서만 import하여 사용자에게 노출합니다

## 4. 코딩 규칙 및 제약사항

### 4.1 필수 준수 사항

1. **순수 matplotlib + dartwork-mpl만 사용**
   - 외부 라이브러리 의존성 최소화
   - `numpy`, `matplotlib`, `dartwork_mpl`만 사용
   - 필요시 표준 라이브러리 사용 가능

2. **USAGE_GUIDE 준수**
   - `.cursor/rules/USAGE_GUIDE.mdc`의 모든 규칙을 준수합니다
   - 스타일 적용: `dm.style.use_preset('scientific')` 등
   - 색상 시스템: `dm.red5`, `tw.blue:500` 등
   - 레이아웃 유틸리티: `dm.simple_layout()`, `dm.cm2in()` 등
   - 폰트 유틸리티: `dm.fs()`, `dm.fw()` 등

3. **CODING_RULES 준수**
   - `.cursor/rules/CODING_RULES.mdc`의 모든 규칙을 준수합니다
   - NumPy 스타일 docstring 필수
   - Python 3.10+ 타입 힌트 사용
   - 모든 구현에 타입 힌트 포함
   - 80컬럼 제한 준수
   - `ruff format` 및 `ruff check` 통과

### 4.2 금지 사항

- ❌ 다른 플랏 모듈에 대한 의존성
- ❌ 외부 데이터 파일 의존성 (샘플 데이터는 코드 내 생성)
- ❌ 복잡한 설정 파일이나 외부 리소스 의존성
- ❌ 결과물을 변경할 수 있는 과한 리팩토링

## 5. 리팩토링 원칙

### 5.1 리팩토링 목적

예시 노트북의 코드를 그대로 복사하는 것이 아니라, **리팩토링을 통해 라이브러리 함수로 변환**합니다.

### 5.2 리팩토링 우선순위

1. **코드 명료함 우선** (확장성보다 명료함)
   - 특수화된 시각화이므로 확장성보다 코드의 명료함이 중요합니다
   - 복잡한 추상화나 과도한 일반화는 피합니다

2. **결과물 보존**
   - 리팩토링 후에도 시각적 결과물이 동일해야 합니다
   - 결과물이 달라질 가능성이 있는 과한 리팩토링은 하지 않습니다

3. **변수화**
   - 하드코딩된 값 중 변수화할 수 있는 것들은 모두 변수화합니다
   - 함수 매개변수로 노출하여 사용자가 커스터마이징할 수 있게 합니다

### 5.3 리팩토링 예시

```python
# ❌ 노트북 예시 (하드코딩)
fig = plt.figure(figsize=(9, 7))
ax.plot(x, y, color='dm.red5', linewidth=0.7)

# ✅ 리팩토링된 함수
def plot_example(
    data: dict[str, np.ndarray],
    figsize: tuple[float, float] | None = None,
    linewidth: float = 0.7,
    color: str = 'dm.red5',
    dpi: int = 200
) -> tuple[Figure, Axes]:
    """
    Plot example visualization.
    
    Parameters
    ----------
    data : dict[str, np.ndarray]
        Dictionary containing 'x' and 'y' arrays.
    figsize : tuple[float, float] | None, optional
        Figure size in inches. If None, uses (9, 7).
    linewidth : float, optional
        Line width for the plot. Default is 0.7.
    color : str, optional
        Color specification. Default is 'dm.red5'.
    dpi : int, optional
        Figure resolution. Default is 200.
    
    Returns
    -------
    fig : matplotlib.figure.Figure
        The created figure object.
    ax : matplotlib.axes.Axes
        The axes containing the plot.
    
    Examples
    --------
    >>> import numpy as np
    >>> import dartwork_mpl as dm
    >>> dm.style.use_preset('scientific')
    >>> 
    >>> # Sample data
    >>> x = np.linspace(0, 10, 100)
    >>> y = np.sin(x)
    >>> data = {'x': x, 'y': y}
    >>> 
    >>> # Create plot
    >>> fig, ax = plot_example(data)
    >>> dm.save_and_show(fig)
    """
    if figsize is None:
        figsize = (9, 7)
    
    fig = plt.figure(figsize=figsize, dpi=dpi)
    ax = fig.add_subplot(111)
    ax.plot(data['x'], data['y'], color=color, linewidth=linewidth)
    
    return fig, ax
```

## 6. 문서화 요구사항

### 6.1 NumPy 스타일 Docstring

모든 플랏 함수는 **NumPy 스타일 docstring**을 포함해야 합니다:

```python
def plot_function(
    param1: type1 | None = None,
    param2: type2 | None = None
) -> tuple[Figure, Axes]:
    """
    Short one-line description.
    
    Longer description explaining what the function does, when to use it,
    and any important context.
    
    Parameters
    ----------
    param1 : type1
        Description of param1. Include units, constraints, or examples.
    param2 : type2 | None, optional
        Description of param2. Default is None.
    
    Returns
    -------
    fig : matplotlib.figure.Figure
        The created figure object.
    ax : matplotlib.axes.Axes
        The axes containing the plot.
    
    Examples
    --------
    >>> import numpy as np
    >>> import dartwork_mpl as dm
    >>> dm.style.use_preset('scientific')
    >>> 
    >>> # Minimal usage - uses default sample data
    >>> fig, ax = plot_function()
    >>> dm.save_and_show(fig)
    >>> 
    >>> # Custom data usage
    >>> data = np.array([1, 2, 3, 4, 5])
    >>> labels = ['A', 'B', 'C', 'D', 'E']
    >>> fig, ax = plot_function(data, labels)
    >>> dm.save_and_show(fig)
    
    Notes
    -----
    Additional notes about the function, implementation details, or
    usage tips.
    
    See Also
    --------
    Related functions or modules.
    """
    pass
```

### 6.2 사용 예시 필수 포함

**Examples 섹션은 반드시 포함**해야 하며, 다음을 포함해야 합니다:

1. **필수 임포트**: `numpy`, `matplotlib.pyplot`, `dartwork_mpl`
2. **스타일 설정**: `dm.style.use_preset('scientific')`
3. **최소 사용 예시**: 인자 없이 호출 가능한 예시 (기본 샘플 데이터 사용)
4. **커스텀 데이터 사용 예시**: 사용자 데이터를 사용하는 예시
5. **함수 호출**: 실제 플랏 함수 호출 예시
6. **결과 확인**: `dm.save_and_show()` 또는 `plt.show()` 사용

### 6.3 상세한 주석

코드 내부에 **유저가 참고할 수 있는 상세한 주석**을 작성합니다:

```python
def plot_function(data: np.ndarray) -> tuple[Figure, Axes]:
    """
    Plot function with detailed comments.
    """
    # Create figure with publication-ready size
    # Using cm2in for consistent unit conversion
    fig = plt.figure(
        figsize=(dm.cm2in(9), dm.cm2in(7)),  # Single column figure
        dpi=200  # High resolution for publication
    )
    
    # Set up GridSpec for precise layout control
    # left/right/top/bottom margins in figure coordinates
    gs = fig.add_gridspec(
        nrows=1, ncols=1,
        left=0.17,   # Left margin: 17% of figure width
        right=0.95,  # Right margin: 5% of figure width
        top=0.95,   # Top margin: 5% of figure height
        bottom=0.17 # Bottom margin: 17% of figure height
    )
    ax = fig.add_subplot(gs[0, 0])
    
    # Plot data with dartwork-mpl color system
    # Using dm.red5 for consistent color palette
    ax.plot(data, color='dm.red5', linewidth=0.7)
    
    # Apply simple_layout for automatic margin optimization
    # This replaces tight_layout() with more predictable results
    # If you have hardcoded elements (title, legend) in figure coordinates,
    # use bbox to optimize only the axes area
    dm.simple_layout(fig)
    
    return fig, ax
```

### 6.4 simple_layout과 하드코딩 레이아웃 호환성

**하드코딩된 요소가 있는 경우** (title, legend가 `fig.text()`, `fig.legend()`로 배치된 경우):

`simple_layout`은 기본적으로 전체 figure를 최적화하므로, figure 좌표계에 직접 배치된 요소와 겹칠 수 있습니다. 이 경우 `bbox` 파라미터를 사용하여 **axes 영역만 최적화**해야 합니다:

```python
def plot_with_hardcoded_elements(
    data: np.ndarray,
    title: str = "Title"
) -> tuple[Figure, Axes]:
    """
    Plot with hardcoded title and legend.
    """
    fig = plt.figure(figsize=(dm.cm2in(12), dm.cm2in(12)), dpi=200)
    
    # Cascading layout calculation
    title_y = 0.98
    legend_y = 0.93
    figure_top = 0.87
    figure_bottom = 0.1
    left_margin = 0.35
    right_margin = 0.95
    
    # Set up GridSpec for axes
    gs = fig.add_gridspec(
        nrows=1, ncols=1,
        left=left_margin,
        right=right_margin,
        top=figure_top,
        bottom=figure_bottom
    )
    ax = fig.add_subplot(gs[0, 0])
    
    # Plot data
    ax.plot(data, color='dm.red5', linewidth=0.7)
    
    # Add hardcoded title (figure coordinates)
    fig.text(0.02, title_y, title, fontsize=dm.fs(2), fontweight=dm.fw(1))
    
    # Add hardcoded legend (figure coordinates)
    fig.legend(bbox_to_anchor=(0.02, legend_y), ...)
    
    # Apply simple_layout with bbox to protect title/legend
    # bbox format: (left, right, bottom, top) in figure coordinates
    # This optimizes only the axes area, leaving title/legend untouched
    dm.simple_layout(
        fig,
        gs=gs,
        bbox=(left_margin, right_margin, figure_bottom, figure_top),
        use_all_axes=False,  # Only optimize axes in this GridSpec
    )
    
    return fig, ax
```

**주요 포인트:**
- `bbox`는 figure 좌표계에서 최적화할 영역을 지정합니다
- title/legend가 있는 영역은 bbox 밖에 두어 보호합니다
- `use_all_axes=False`로 지정된 GridSpec의 axes만 최적화합니다

## 7. 샘플 데이터 및 사용 예시

### 7.1 샘플 데이터 필수 포함

모든 플랏 함수는 **유저가 아무런 준비 없이 바로 사용할 수 있는 샘플 데이터**를 포함해야 합니다. 모든 데이터 인자는 optional로 만들고 기본 샘플 데이터를 제공하여, 함수를 인자 없이 호출해도 작동하도록 해야 합니다:

```python
def plot_example(
    data: np.ndarray | None = None,
    labels: list[str] | None = None
) -> tuple[Figure, Axes]:
    """
    Plot example.
    
    Examples
    --------
    >>> import numpy as np
    >>> import dartwork_mpl as dm
    >>> dm.style.use_preset('scientific')
    >>> 
    >>> # Minimal usage - uses default sample data
    >>> fig, ax = plot_example()
    >>> dm.save_and_show(fig)
    >>> 
    >>> # Custom data usage
    >>> data = np.array([64, 58, 57, 54, 51, 49, 45, 43, 42])
    >>> labels = [
    ...     "Category A", "Category B", "Category C",
    ...     "Category D", "Category E", "Category F",
    ...     "Category G", "Category H", "Category I"
    ... ]
    >>> fig, ax = plot_example(data, labels)
    >>> dm.save_and_show(fig)
    """
    # Use provided data or generate sample data
    if data is None:
        data = np.array([64, 58, 57, 54, 51, 49, 45, 43, 42])
    if labels is None:
        labels = [
            "Category A", "Category B", "Category C",
            "Category D", "Category E", "Category F",
            "Category G", "Category H", "Category I"
        ]
    
    # ... rest of implementation
```

### 7.2 입력 인자 기본값

모든 입력 인자는 **합리적인 기본값**을 가져야 하며, 기본값만으로도 작동해야 합니다. 특히 데이터 인자들은 모두 optional로 만들어 기본 샘플 데이터를 제공하여, 함수를 인자 없이 호출해도 작동하도록 해야 합니다:

```python
def plot_example(
    data: np.ndarray | None = None,
    labels: list[str] | None = None,
    figsize: tuple[float, float] | None = None,
    dpi: int = 200,
    color: str = 'dm.red5',
    linewidth: float = 0.7
) -> tuple[Figure, Axes]:
    """
    Plot example with all parameters having sensible defaults.
    
    Examples
    --------
    >>> import numpy as np
    >>> import dartwork_mpl as dm
    >>> dm.style.use_preset('scientific')
    >>> 
    >>> # Minimal usage - all defaults (no arguments needed)
    >>> fig, ax = plot_example()
    >>> dm.save_and_show(fig)
    >>> 
    >>> # Custom data usage
    >>> data = np.array([1, 2, 3, 4, 5])
    >>> labels = ['A', 'B', 'C', 'D', 'E']
    >>> fig, ax = plot_example(data, labels)
    >>> dm.save_and_show(fig)
    >>> 
    >>> # Customized usage with styling
    >>> fig, ax = plot_example(
    ...     data,
    ...     labels,
    ...     figsize=(12, 8),
    ...     color='dm.blue5',
    ...     linewidth=1.2
    ... )
    >>> dm.save_and_show(fig)
    """
    # Use default sample data if not provided
    if data is None:
        data = np.array([1, 2, 3, 4, 5])
    if labels is None:
        labels = ['A', 'B', 'C', 'D', 'E']
    
    # ... rest of implementation
```

## 8. 소스코드 출력 함수

### 8.1 필수 포함 사항

모든 플랏 모듈은 **자기 자신의 소스코드를 출력하는 함수**를 포함해야 합니다:

```python
def get_source_code() -> str:
    """
    Return the source code of this module as a string.
    
    This function is used to provide the source code to coding agents
    as input for further development or modification.
    
    Returns
    -------
    str
        The complete source code of this module.
    
    Examples
    --------
    >>> source = get_source_code()
    >>> print(source)
    """
    import inspect
    import importlib
    
    # Get the current module
    module_name = __name__
    module = importlib.import_module(module_name)
    
    # Get the source file path
    source_file = inspect.getfile(module)
    
    # Read and return the source code
    with open(source_file, 'r', encoding='utf-8') as f:
        return f.read()
```

### 8.2 사용 목적

이 함수는 다음 목적으로 사용됩니다:
- 코딩 에이전트가 소스코드를 복사하여 입력으로 사용
- 문서화나 예시 생성
- 코드 리뷰나 수정 작업의 기반

## 9. 단계별 구현 프로세스

### 9.1 Phase 분리 원칙

**여러 플랏 기능이 한 예시 노트북에 구현된 경우**, phase를 나눠서 구현합니다:

1. **사용자에게 재질문하여 스코프 명확화**
   - 어떤 플랏을 먼저 구현할지 확인
   - 각 플랏의 우선순위 확인
   - 구현 범위 확인

2. **Phase별 구현**
   - Phase 1: 첫 번째 플랏 함수 구현
   - Phase 2: 두 번째 플랏 함수 구현
   - 각 phase는 독립적으로 완료되어야 함

### 9.2 구현 단계

#### Step 1: 예시 파일 분석
- 노트북 파일을 읽고 구조 파악
- 플랏 기능 식별 및 분리
- 데이터 준비 코드와 플랏 코드 구분

#### Step 2: 스코프 확인 (필요시)
- 여러 플랏이 있으면 사용자에게 확인
- 구현할 플랏 선택 및 우선순위 결정

#### Step 3: 함수 시그니처 설계
- 입력 매개변수 정의
- 반환값 정의 (일반적으로 `tuple[Figure, Axes]`)
- 기본값 설정

#### Step 4: 리팩토링 및 구현
- 노트북 코드를 함수로 변환
- 하드코딩된 값 변수화
- 주석 추가
- 타입 힌트 추가

#### Step 5: 문서화
- NumPy 스타일 docstring 작성
- 사용 예시 포함 (샘플 데이터 포함)
- Notes 및 See Also 섹션 추가

#### Step 6: 소스코드 출력 함수 추가
- `get_source_code()` 함수 구현

#### Step 7: 테스트 및 검증
- 샘플 데이터로 함수 실행
- 결과물이 원본 노트북과 동일한지 확인
- `ruff format` 및 `ruff check` 실행

#### Step 8: 패키지 통합
- `src/dartwork_mpl/xplot/__init__.py`에 함수 export
- 필요시 패키지 초기화 코드 추가

### 9.3 구현 체크리스트

구현 완료 전 다음을 확인합니다:

- [ ] 함수가 독립적으로 작동하는가?
- [ ] 모든 매개변수에 타입 힌트가 있는가?
- [ ] NumPy 스타일 docstring이 완전한가?
- [ ] 사용 예시가 포함되어 있는가?
- [ ] 인자 없이 호출 가능한가? (기본 샘플 데이터 제공)
- [ ] 모든 데이터 인자가 optional이고 기본값이 제공되는가?
- [ ] 모든 하드코딩된 값이 변수화되었는가?
- [ ] 상세한 주석이 포함되어 있는가?
- [ ] `get_source_code()` 함수가 포함되어 있는가?
- [ ] `ruff format` 및 `ruff check`를 통과하는가?
- [ ] 결과물이 원본 노트북과 동일한가?
- [ ] USAGE_GUIDE를 준수하는가?
- [ ] CODING_RULES를 준수하는가?

## 10. 구현 예시

### 10.1 완전한 예시

```python
"""
Comparison change rate dotplot visualization.

This module provides a function to create dot plots comparing success rates
across different categories with baseline comparisons.
"""

import numpy as np
import matplotlib.pyplot as plt
from matplotlib.figure import Figure
from matplotlib.axes import Axes

import dartwork_mpl as dm


def plot_comparison_dotplot(
    categories: list[str] | None = None,
    success_values: np.ndarray | None = None,
    other_values: np.ndarray | None = None,
    figsize: tuple[float, float] | None = None,
    dpi: int = 200,
    title: str | None = None,
    colors: dict[str, str] | None = None
) -> tuple[Figure, Axes]:
    """
    Create a dot plot comparing success rates across categories.
    
    This function visualizes success rates as dots with optional baseline
    comparison tracks. The visualization is optimized for publication use
    with dartwork-mpl styling.
    
    Parameters
    ----------
    categories : list[str] | None, optional
        List of category names to display on the y-axis. If None, uses
        default sample data. Default is None.
    success_values : np.ndarray | None, optional
        Array of success rate values (one per category). If None, uses
        default sample data. Default is None.
    other_values : np.ndarray | None, optional
        Array of baseline/comparison values. If None, only success values
        are displayed. Default is None.
    figsize : tuple[float, float] | None, optional
        Figure size in inches (width, height). If None, uses (13cm, 9cm).
        Default is None.
    dpi : int, optional
        Figure resolution in dots per inch. Default is 200.
    title : str | None, optional
        Title for the plot. If None, no title is displayed. Default is None.
    colors : dict[str, str] | None, optional
        Color dictionary with keys 'success' and 'other'. If None, uses
        default dartwork-mpl colors. Default is None.
    
    Returns
    -------
    fig : matplotlib.figure.Figure
        The created figure object.
    ax : matplotlib.axes.Axes
        The axes containing the plot.
    
    Examples
    --------
    >>> import numpy as np
    >>> import dartwork_mpl as dm
    >>> dm.style.use_preset('scientific')
    >>> 
    >>> # Minimal usage - uses default sample data
    >>> fig, ax = plot_comparison_dotplot()
    >>> dm.save_and_show(fig)
    >>> 
    >>> # Custom data usage
    >>> categories = [
    ...     "Automated Customer Support",
    ...     "Predictive Maintenance",
    ...     "Supply Chain Optimization",
    ...     "Fraud Detection",
    ...     "Personalized Marketing"
    ... ]
    >>> success_values = np.array([64, 58, 57, 54, 51], dtype=float)
    >>> other_values = np.array([20, 23, 24, 25, 26], dtype=float)
    >>> fig, ax = plot_comparison_dotplot(
    ...     categories,
    ...     success_values,
    ...     other_values
    ... )
    >>> dm.save_and_show(fig)
    >>> 
    >>> # Customized plot
    >>> fig, ax = plot_comparison_dotplot(
    ...     categories,
    ...     success_values,
    ...     other_values,
    ...     title="AI Adoption Success Rates",
    ...     colors={'success': 'dm.green3', 'other': 'dm.gray4'}
    ... )
    >>> dm.save_and_show(fig)
    
    Notes
    -----
    - The function uses dartwork-mpl styling for consistent appearance
    - GridSpec is used for precise layout control
    - Colors follow dartwork-mpl color system (dm.* or tw.*)
    
    See Also
    --------
    dartwork_mpl.style.use_preset : Apply dartwork-mpl style presets
    dartwork_mpl.simple_layout : Optimize figure layout
    """
    # Use default sample data if not provided
    if categories is None:
        categories = [
            "Automated Customer Support",
            "Predictive Maintenance",
            "Supply Chain Optimization",
            "Fraud Detection",
            "Personalized Marketing"
        ]
    if success_values is None:
        success_values = np.array([64, 58, 57, 54, 51], dtype=float)
    
    # Set default figure size using cm2in for unit conversion
    if figsize is None:
        figsize = (dm.cm2in(13), dm.cm2in(9))
    
    # Set default colors using dartwork-mpl color system
    if colors is None:
        colors = {
            'success': 'dm.green3',
            'other': 'dm.gray4'
        }
    
    # Create figure with publication-ready settings
    fig = plt.figure(figsize=figsize, dpi=dpi)
    
    # Set up GridSpec for precise layout control
    # Margins: left=30%, right=95%, top=95%, bottom=10%
    gs = fig.add_gridspec(
        nrows=1, ncols=1,
        left=0.3,   # Left margin for y-axis labels
        right=0.95, # Right margin
        top=0.95,   # Top margin
        bottom=0.1  # Bottom margin
    )
    ax = fig.add_subplot(gs[0, 0])
    
    # Calculate y positions for categories
    y_pos = np.arange(len(categories))
    
    # Plot baseline tracks if provided
    if other_values is not None:
        # Draw horizontal tracks for baseline values
        for i, val in enumerate(other_values):
            ax.plot(
                [0, val], [y_pos[i], y_pos[i]],
                color=colors['other'],
                linewidth=dm.lw(10),  # Use dartwork-mpl linewidth
                zorder=1
            )
    
    # Plot success values as dots
    ax.scatter(
        success_values,
        y_pos,
        color=colors['success'],
        s=100,  # Marker size
        zorder=2
    )
    
    # Set y-axis labels
    ax.set_yticks(y_pos)
    ax.set_yticklabels(categories)
    
    # Set x-axis label
    ax.set_xlabel('Success Rate [%]')
    
    # Add title if provided
    if title:
        ax.set_title(title, fontsize=dm.fs(1), fontweight=dm.fw(1))
    
    # Apply simple_layout for automatic margin optimization
    dm.simple_layout(fig)
    
    return fig, ax


def get_source_code() -> str:
    """
    Return the source code of this module as a string.
    
    This function is used to provide the source code to coding agents
    as input for further development or modification.
    
    Returns
    -------
    str
        The complete source code of this module.
    
    Examples
    --------
    >>> source = get_source_code()
    >>> print(source)
    """
    import inspect
    import importlib
    
    # Get the current module
    module_name = __name__
    module = importlib.import_module(module_name)
    
    # Get the source file path
    source_file = inspect.getfile(module)
    
    # Read and return the source code
    with open(source_file, 'r', encoding='utf-8') as f:
        return f.read()
```

## 11. 주의사항 및 모범 사례

### 11.1 하지 말아야 할 것

- ❌ 노트북 코드를 그대로 복사 (리팩토링 필수)
- ❌ 결과물을 변경하는 과한 리팩토링
- ❌ 외부 의존성 추가
- ❌ 다른 플랏 모듈에 대한 의존성
- ❌ 샘플 데이터 없이 함수 구현
- ❌ 타입 힌트 누락
- ❌ docstring 예시 누락
- ❌ 하드코딩된 값 남기기

### 11.2 반드시 해야 할 것

- ✅ 노트북 코드를 함수로 리팩토링
- ✅ 모든 매개변수 변수화
- ✅ NumPy 스타일 docstring 작성
- ✅ 사용 예시 포함 (샘플 데이터 포함)
- ✅ 상세한 주석 작성
- ✅ `get_source_code()` 함수 포함
- ✅ 타입 힌트 완전히 작성
- ✅ `ruff format` 및 `ruff check` 통과
- ✅ USAGE_GUIDE 및 CODING_RULES 준수
- ✅ 결과물이 원본과 동일한지 검증

### 11.3 검증 체크리스트

구현 완료 후 다음을 확인:

1. **기능 검증**
   - [ ] 샘플 데이터로 함수가 정상 작동하는가?
   - [ ] 모든 매개변수가 올바르게 작동하는가?
   - [ ] 결과물이 원본 노트북과 시각적으로 동일한가?

2. **코드 품질**
   - [ ] `ruff format` 통과하는가?
   - [ ] `ruff check` 통과하는가?
   - [ ] 타입 힌트가 완전한가?
   - [ ] docstring이 완전한가?

3. **문서화**
   - [ ] 사용 예시가 포함되어 있는가?
   - [ ] 샘플 데이터가 바로 사용 가능한가?
   - [ ] 주석이 충분히 상세한가?

4. **규칙 준수**
   - [ ] USAGE_GUIDE를 준수하는가?
   - [ ] CODING_RULES를 준수하는가?
   - [ ] 독립적으로 작동하는가?

## 12. 요약

개별 플랏 함수를 개발할 때 다음을 기억하세요:

1. **입력**: 노트북 예시 파일 (`test/new_features/[plot] *.ipynb`)
2. **출력**: `src/dartwork_mpl/xplot/*.py` 독립 모듈
3. **원칙**: 리팩토링하되 결과물 보존, 명료함 우선
4. **문서화**: NumPy 스타일 docstring + 사용 예시 필수
5. **편의성**: 샘플 데이터 + 기본값으로 바로 사용 가능
6. **완전성**: 소스코드 출력 함수 + 상세 주석 포함

이 가이드를 따라 구현하면, 사용자가 바로 사용할 수 있는 고품질의 플랏 함수를 만들 수 있습니다.
